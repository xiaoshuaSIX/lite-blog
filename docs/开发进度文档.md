# Lite-Blog 开发进度文档

**更新时间**: 2025-12-14

---

## 项目概述

基于角色的博客系统，支持会员内容预览、邮箱验证、RBAC 权限控制、深色模式、多语言切换、网站设置管理。

**技术栈**:
- Frontend: Next.js 16 (App Router), TailwindCSS, shadcn/ui, next-themes
- Backend: Go, Gin, GORM, SQLite
- Email: AWS SES
- Ports: Backend 8080, Frontend 3000

---

## 已完成任务

### Phase 0: 基础设施搭建 ✅

#### Task 0.1: 后端初始化 ✅
#### Task 0.2: 前端初始化 ✅

---

### Phase 1: 数据库与模型 ✅

#### Task 1.1: 用户与权限模型 ✅
#### Task 1.2: 文章与评论模型 ✅

---

### Phase 2: 认证体系 ✅

#### Task 2.1-2.3: 认证系统 ✅

**已创建文件**:
- `backend/cmd/server/main.go` - 应用入口
- `backend/internal/repository/user.go` - 用户数据访问层
- `backend/internal/repository/role.go` - 角色数据访问层
- `backend/pkg/jwt/jwt.go` - JWT 工具
- `backend/internal/service/email.go` - 邮件服务
- `backend/internal/service/auth.go` - 认证服务
- `backend/internal/api/middleware/auth.go` - 认证中间件
- `backend/internal/api/middleware/rbac.go` - RBAC 中间件
- `backend/internal/api/handler/auth.go` - 认证处理器

**已实现并测试 API**:
- `POST /api/auth/register` - 用户注册 ✅
- `POST /api/auth/login` - 用户登录 ✅
- `POST /api/auth/logout` - 用户登出 ✅
- `GET /api/auth/me` - 获取当前用户 ✅
- `POST /api/auth/verify-email` - 邮箱验证 ✅
- `POST /api/auth/resend-verification` - 重发验证邮件 ✅

---

### Phase 3: 核心业务逻辑 ✅

#### Task 3.1: 智能预览算法 ✅

**已创建文件**:
- `backend/internal/service/preview.go` - 智能预览算法

**功能**:
- 按百分比截取内容
- 最小字数保证
- 智能段落边界截断
- 支持中英文

#### Task 3.2: 公开文章接口 ✅

**已创建文件**:
- `backend/internal/repository/article.go` - 文章数据访问层
- `backend/internal/service/article.go` - 文章服务
- `backend/internal/api/handler/article.go` - 文章处理器

**已实现 API**:
- `GET /api/articles` - 文章列表
- `GET /api/articles/:slug` - 文章详情（含内容遮罩逻辑）

#### Task 3.3: 评论功能 ✅

**已创建文件**:
- `backend/internal/repository/comment.go` - 评论数据访问层
- `backend/internal/service/comment.go` - 评论服务
- `backend/internal/api/handler/comment.go` - 评论处理器

**已实现 API**:
- `GET /api/comments/article/:articleId` - 评论列表
- `POST /api/comments/article/:articleId` - 发表评论（需邮箱验证）

---

### Phase 4: 前端业务实现 ✅

#### Task 4.1: 认证页面 ✅

**已创建文件**:
- `frontend/lib/api.ts` - API 客户端
- `frontend/hooks/use-auth.ts` - 认证 Hook
- `frontend/providers/auth-provider.tsx` - 认证 Context
- `frontend/app/(auth)/layout.tsx` - 认证页面布局
- `frontend/app/(auth)/login/page.tsx` - 登录页
- `frontend/app/(auth)/register/page.tsx` - 注册页
- `frontend/app/(auth)/verify-email/page.tsx` - 邮箱验证页

#### Task 4.2: 首页与文章页面 ✅

**已创建文件**:
- `frontend/components/layout/header.tsx` - 头部组件
- `frontend/components/layout/footer.tsx` - 页脚组件
- `frontend/components/home/hero-section.tsx` - 首页 Hero 区域
- `frontend/app/page.tsx` - 首页（含文章列表）
- `frontend/app/posts/[slug]/page.tsx` - 文章详情页（含付费墙 UI）

**功能**:
- 文章列表展示
- 文章详情渲染
- 会员内容预览遮罩
- "成为会员" CTA 按钮

---

### Phase 5: 后台管理系统 ✅

#### Task 5.1: 后台布局与鉴权 ✅

**已创建文件**:
- `frontend/app/admin/layout.tsx` - 后台布局（含管理员权限检查）
- `frontend/app/admin/page.tsx` - 后台仪表盘

#### Task 5.2: 文章管理 ✅

**已创建文件**:
- `frontend/lib/admin-api.ts` - 管理员 API 客户端
- `frontend/app/admin/articles/page.tsx` - 文章列表
- `frontend/app/admin/articles/new/page.tsx` - 新建文章
- `frontend/app/admin/articles/[id]/edit/page.tsx` - 编辑文章

**后端 API**:
- `GET /api/admin/articles` - 获取所有文章
- `GET /api/admin/articles/:id` - 获取单篇文章
- `POST /api/admin/articles` - 创建文章
- `PUT /api/admin/articles/:id` - 更新文章
- `DELETE /api/admin/articles/:id` - 删除文章
- `POST /api/admin/articles/:id/publish` - 发布文章
- `POST /api/admin/articles/:id/unpublish` - 取消发布
- `DELETE /api/admin/comments/:id` - 删除评论

#### Task 5.3: 用户管理（占位） ✅

**已创建文件**:
- `frontend/app/admin/users/page.tsx` - 用户管理页面（占位）

---

### Phase 6: 国际化与设置 ✅ (新增)

#### Task 6.1: 多语言支持 ✅

**已创建文件**:
- `frontend/lib/i18n/index.ts` - i18n 配置
- `frontend/lib/i18n/locales/zh.json` - 中文翻译
- `frontend/lib/i18n/locales/en.json` - 英文翻译
- `frontend/providers/language-provider.tsx` - 语言 Context
- `frontend/components/language-switcher.tsx` - 语言切换器

**功能**:
- 中英文切换
- 语言偏好本地存储
- 动态更新 html lang 属性

#### Task 6.2: 网站设置 ✅

**已创建文件**:
- `backend/internal/model/setting.go` - 设置模型
- `backend/internal/repository/setting.go` - 设置数据访问层
- `backend/internal/service/setting.go` - 设置服务
- `backend/internal/api/handler/setting.go` - 设置处理器
- `frontend/providers/settings-provider.tsx` - 设置 Context
- `frontend/app/admin/settings/page.tsx` - 设置管理页面

**已实现 API**:
- `GET /api/settings` - 获取网站设置（公开）
- `GET /api/admin/settings` - 获取网站设置（管理员）
- `PUT /api/admin/settings` - 更新网站设置

**可配置项**:
- 网站名称
- 网站描述
- 网站关键词
- 首页标题
- 首页副标题
- 页脚文字
- Logo URL

---

## 项目结构

### Backend 最终结构

```
backend/
├── cmd/server/main.go              ✅
├── internal/
│   ├── api/
│   │   ├── handler/
│   │   │   ├── auth.go             ✅
│   │   │   ├── article.go          ✅
│   │   │   ├── comment.go          ✅
│   │   │   └── setting.go          ✅ (新增)
│   │   ├── middleware/
│   │   │   ├── auth.go             ✅
│   │   │   ├── cors.go             ✅
│   │   │   └── rbac.go             ✅
│   │   └── router/router.go        ✅
│   ├── service/
│   │   ├── auth.go                 ✅
│   │   ├── email.go                ✅
│   │   ├── preview.go              ✅
│   │   ├── article.go              ✅
│   │   ├── comment.go              ✅
│   │   └── setting.go              ✅ (新增)
│   ├── repository/
│   │   ├── user.go                 ✅
│   │   ├── role.go                 ✅
│   │   ├── article.go              ✅
│   │   ├── comment.go              ✅
│   │   └── setting.go              ✅ (新增)
│   ├── model/
│   │   ├── user.go                 ✅
│   │   ├── article.go              ✅
│   │   ├── comment.go              ✅
│   │   ├── setting.go              ✅ (新增)
│   │   └── migrate.go              ✅
│   └── config/config.go            ✅
├── pkg/
│   ├── jwt/jwt.go                  ✅
│   └── logger/logger.go            ✅
├── configs/
│   ├── config.yaml                 ✅
│   └── config.example.yaml         ✅
├── go.mod                          ✅
└── Makefile                        ✅
```

### Frontend 最终结构

```
frontend/
├── app/
│   ├── (auth)/
│   │   ├── layout.tsx              ✅
│   │   ├── login/page.tsx          ✅
│   │   ├── register/page.tsx       ✅
│   │   └── verify-email/page.tsx   ✅
│   ├── admin/
│   │   ├── layout.tsx              ✅
│   │   ├── page.tsx                ✅
│   │   ├── articles/
│   │   │   ├── page.tsx            ✅
│   │   │   ├── new/page.tsx        ✅
│   │   │   └── [id]/edit/page.tsx  ✅ (新增)
│   │   ├── users/page.tsx          ✅
│   │   └── settings/page.tsx       ✅ (新增)
│   ├── posts/[slug]/page.tsx       ✅
│   ├── layout.tsx                  ✅
│   ├── page.tsx                    ✅
│   └── globals.css                 ✅
├── components/
│   ├── layout/
│   │   ├── header.tsx              ✅
│   │   └── footer.tsx              ✅ (新增)
│   ├── home/
│   │   └── hero-section.tsx        ✅ (新增)
│   ├── ui/
│   │   ├── button.tsx              ✅
│   │   └── dropdown-menu.tsx       ✅
│   ├── theme/
│   │   └── theme-toggle.tsx        ✅
│   └── language-switcher.tsx       ✅ (新增)
├── lib/
│   ├── api.ts                      ✅
│   ├── admin-api.ts                ✅
│   ├── utils.ts                    ✅
│   └── i18n/                       ✅ (新增)
│       ├── index.ts
│       └── locales/
│           ├── zh.json
│           └── en.json
├── hooks/
│   └── use-auth.ts                 ✅
├── providers/
│   ├── theme-provider.tsx          ✅
│   ├── auth-provider.tsx           ✅
│   ├── language-provider.tsx       ✅ (新增)
│   └── settings-provider.tsx       ✅ (新增)
├── package.json                    ✅
└── tsconfig.json                   ✅
```

---

## API 文档

### 认证 API

| 方法 | 路径 | 描述 | 权限 |
|------|------|------|------|
| POST | /api/auth/register | 用户注册 | 公开 |
| POST | /api/auth/login | 用户登录 | 公开 |
| POST | /api/auth/logout | 用户登出 | 公开 |
| GET | /api/auth/me | 获取当前用户 | 登录 |
| POST | /api/auth/verify-email | 邮箱验证 | 公开 |
| POST | /api/auth/resend-verification | 重发验证邮件 | 登录 |

### 文章 API

| 方法 | 路径 | 描述 | 权限 |
|------|------|------|------|
| GET | /api/articles | 获取已发布文章列表 | 公开 |
| GET | /api/articles/:slug | 获取文章详情 | 公开 |

### 评论 API

| 方法 | 路径 | 描述 | 权限 |
|------|------|------|------|
| GET | /api/comments/article/:articleId | 获取文章评论 | 公开 |
| POST | /api/comments/article/:articleId | 发表评论 | 登录+邮箱验证 |

### 设置 API

| 方法 | 路径 | 描述 | 权限 |
|------|------|------|------|
| GET | /api/settings | 获取网站设置 | 公开 |

### 管理员 API

| 方法 | 路径 | 描述 | 权限 |
|------|------|------|------|
| GET | /api/admin/articles | 获取所有文章 | Admin |
| GET | /api/admin/articles/:id | 获取单篇文章 | Admin |
| POST | /api/admin/articles | 创建文章 | Admin |
| PUT | /api/admin/articles/:id | 更新文章 | Admin |
| DELETE | /api/admin/articles/:id | 删除文章 | Admin |
| POST | /api/admin/articles/:id/publish | 发布文章 | Admin |
| POST | /api/admin/articles/:id/unpublish | 取消发布 | Admin |
| DELETE | /api/admin/comments/:id | 删除评论 | Admin |
| GET | /api/admin/settings | 获取网站设置 | Admin |
| PUT | /api/admin/settings | 更新网站设置 | Admin |

---

## 如何运行

### 后端

#### 环境变量配置

复制 `.env.example` 文件并配置：

```bash
cd backend
cp .env.example .env
```

编辑 `.env` 文件，配置以下环境变量：

| 变量名 | 说明 | 示例值 |
|--------|------|--------|
| AWS_ACCESS_KEY_ID | AWS 访问密钥 ID | your_access_key_id |
| AWS_SECRET_ACCESS_KEY | AWS 访问密钥 | your_secret_access_key |
| AWS_REGION | AWS 区域 | us-east-1 |
| JWT_SECRET | JWT 签名密钥 | your-secret-key-change-in-production |
| SERVER_PORT | 服务端口 | 8080 |
| SERVER_MODE | 运行模式 (debug/release) | debug |
| DATABASE_PATH | SQLite 数据库路径 | ./blog.db |
| FRONTEND_PROXY | 前端代理地址（开发用） | http://localhost:3000 |
| CORS_ORIGINS | CORS 允许的源 | http://localhost:3000 |

#### 启动服务

```bash
cd backend
go build -o bin/server cmd/server/main.go
./bin/server
# 服务运行在 http://localhost:8080
```

或使用 go run:

```bash
cd backend
go run cmd/server/main.go
```

### 前端

```bash
cd frontend
npm install
npm run dev
# 服务运行在 http://localhost:3000
```

---

## 用户角色

| 角色 | 代码 | 权限 |
|------|------|------|
| Guest | guest | 查看文章预览 |
| User | user | 查看文章预览、发表评论 |
| Member | member | 查看完整文章、发表评论 |
| Admin | admin | 所有权限 |

---

## 待优化/扩展

1. 用户管理 API（后端）
2. 会员充值功能
3. Markdown 渲染优化
4. 评论管理页面
5. RSS 订阅功能
6. 搜索功能
7. 分页优化
8. 图片上传功能
9. SEO 优化
